# 管理员功能说明

## 功能概述

本项目实现了完整的管理员功能，包括用户管理、在线监控、聊天记录查看等功能。

## 主要功能

### 1. 管理员控制台 (`/admin`)
- 提供功能导航界面
- 包含用户管理、在线人员、聊天记录、群组管理等功能入口

### 2. 用户管理 (`/admin/users`)
- **用户列表展示**：分管理员和普通用户两个区域
- **权限管理**：设置/移除管理员权限
- **用户状态管理**：禁用/启用用户账号
- **禁言功能**：禁言/解除禁言用户
- **删除用户**：删除用户账号（会同时删除相关数据）
- **在线用户显示**：显示当前在线用户列表

### 3. 在线人员管理 (`/admin/online-users`)
- **在线用户统计**：显示在线用户数量和总用户数
- **在线用户列表**：实时显示在线用户信息
- **强制下线**：强制用户下线功能
- **实时刷新**：支持手动刷新在线状态

### 4. 聊天记录监控 (`/admin/chat-monitor`)
- **多维度筛选**：
  - 按用户ID筛选
  - 按群组ID筛选
  - 关键词搜索
  - 时间范围筛选（1小时、24小时、7天、30天）
- **分页显示**：支持分页查看，可调整每页显示数量
- **详细信息**：显示发送者、接收者、群组、时间等完整信息

## 后端接口

### 用户管理接口
- `GET /api/user/list` - 获取用户列表
- `POST /api/user/set_admin` - 设置/移除管理员
- `POST /api/user/delete` - 删除用户
- `POST /api/user/ban` - 禁用用户
- `POST /api/user/unban` - 启用用户
- `POST /api/user/mute` - 禁言用户
- `POST /api/user/unmute` - 解除禁言
- `POST /api/user/kick` - 强制下线
- `GET /api/user/online_list` - 获取在线用户列表
- `GET /api/user/<user_id>/online` - 检查用户在线状态

### 聊天记录接口
- `GET /api/message/list` - 获取聊天记录（支持筛选和分页）

## 数据库变更

### 新增字段
- `users` 表新增 `is_muted` 字段（BOOLEAN，默认FALSE）

### 运行迁移
```bash
cd PingChat-backend
python migrate_add_muted.py
```

## 前端组件

### 主要组件
- `AdminView.vue` - 管理员主页面
- `AdminUserList.vue` - 用户管理组件
- `AdminUserActions.vue` - 用户操作组件（在线状态和强制下线）
- `online-users.vue` - 在线人员页面
- `chat-monitor.vue` - 聊天记录监控页面

### 路由配置
- `/admin` - 管理员控制台
- `/admin/users` - 用户管理
- `/admin/online-users` - 在线人员
- `/admin/chat-monitor` - 聊天记录

## 使用说明

### 1. 访问管理员功能
- 登录管理员账号
- 访问 `/admin` 进入管理员控制台
- 点击相应功能卡片进入具体功能页面

### 2. 用户管理操作
- 在用户卡片上点击相应按钮进行操作
- 支持批量操作和单个用户操作
- 操作后会自动刷新用户列表

### 3. 在线监控
- 实时查看在线用户
- 点击"强制下线"按钮可踢出用户
- 支持手动刷新在线状态

### 4. 聊天记录查看
- 使用筛选条件查找特定聊天记录
- 支持多条件组合筛选
- 分页浏览大量聊天记录

## 注意事项

1. **权限控制**：所有管理员功能都需要管理员权限
2. **数据安全**：删除用户会同时删除相关数据，请谨慎操作
3. **实时性**：在线状态基于WebSocket连接，断开连接后状态会更新
4. **性能考虑**：聊天记录查询支持分页，避免一次性加载大量数据

## 技术实现

### 前端技术栈
- Vue 3 + Composition API
- Vue Router 4
- Tailwind CSS
- Material Symbols 图标

### 后端技术栈
- Flask
- SQLAlchemy
- Flask-SocketIO
- PyMySQL

### 关键特性
- 响应式设计
- 实时数据更新
- 权限控制
- 数据筛选和分页
- 用户友好的界面 